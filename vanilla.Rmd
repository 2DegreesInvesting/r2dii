---
title: "r2dii"
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  cache = TRUE,
  collapse = TRUE,
  comment = "#>",
  out.width = "100%"
)
```

Because tilt's software is in early stages of development, we still lack a
minimum viable product to demonstrate the entire workflow from end to end.
However, tilt's software is very similar to [r2dii's
software](https://pacta.rmi.org/pacta-for-banks-2020/), which is mature, and was
originally developed by 2DII. Therefore this article shows the r2dii workflow
instead.

The r2dii workflow involves multiple software components. For every use case,
there are multiple ways to combine those multiple components. The most direct
and flexible way is via a computational document like the one you're reading.

This workflow is run by a bank, entirely in its machine. It uses one dataset of
its own, plus some datasets from the r2dii team.

## The bank uses the required software

``` {r use-r2dii}
# General software
library(tidyverse, warn.conflicts = FALSE)

# r2dii software
# * Toy data from banks and from tilt data-management. Eventually tiltToyData.
library(r2dii.data)
# * Like tilt.company.match, eventually tiltMatch
library(r2dii.match)
# * Like tiltIndicator
library(r2dii.analysis)
# * Like tiltPlot
library(r2dii.plot)
```

## The bank matches their own data with external data

```{r}
# Private data from the bank
loanbook <- r2dii.data::loanbook_demo
# Asset-level data from the r2dii team
abcd <- r2dii.data::abcd_demo

matched <- match_name(loanbook, abcd)

matched
```

## The bank validates and prioritized the matches

The bank saves the matched dataset to validate it manually.

```r
write_csv(matched, "to_validate.csv")
```

The bank validates the matches manually, then reads the validated dataset.

```r
read_csv("validated.csv")
```

```{r echo=FALSE}
validated <- matched
```

Where the number of perfect matches is greater than one, [pick the one with highest priority](https://rmi-pacta.github.io/r2dii.match/reference/prioritize.html).

```{r}
prioritized <- prioritize(validated)

prioritized
```

## The bank calculates a metric

calculate scenario targets for the `production` of a technology in a sector, at the portfolio level using the [Market Share Approach](https://rmi-pacta.github.io/r2dii.analysis/articles/target-market-share.html).

```{r market-share-targets-portfolio}
# Datasets that the bank gets from a data provider
scenario <- r2dii.data::scenario_demo_2020
regions <- r2dii.data::region_isos_demo

targets <- prioritized |>
  target_market_share(abcd = abcd, scenario = scenario, region_isos = regions)

targets
```

## The bank visualizes the calculated metric

Visualize the portfolio's exposure to various climate sensitive technologies
(`projected`), and compare with the corporate economy, or against various
scenario targets.

```{r technoloy-mix-portfolio}
# Pick the targets you want to plot
picked <- filter(
  targets,
  scenario_source == "demo_2020",
  sector == "power",
  region == "global",
  metric %in% c("projected", "corporate_economy", "target_sds")
)

# Plot the technology mix
qplot_techmix(picked)
```
